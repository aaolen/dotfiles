#!/bin/bash

readonly SCRIPT_DIR=$(dirname $(readlink -f "$0"))

# default DOT_HOME to ~/dotfiles if not set
if [ -z ${DOT_HOME+x} ]; then
    DOT_HOME=$HOME/dotfiles
fi

# ============================================================================
# Symlink Files
# ============================================================================

# include hidden files in search
GLOBIGNORE=".:.."

echo
echo "Symlinking files..."

for file in $DOT_HOME/home/*; do
    filename=$(echo $file | rev | cut -d'/' -f-1 | rev)
    target=$HOME/$filename

    # check if the target file is already a symlink to the file
    if [ "$(readlink "$target")" = $file ]; then
        echo "$filename is already symlinked."
        continue
    fi

    # save target file if it already exists
    if [ -e $target ]; then
        echo "Moving existing $target to ~/dotfiles/.old/"
        mkdir -p $DOT_HOME/.old && mv $target $_
    fi

    ln -s "$file" "$HOME"
    echo "Created symlink to $filename in home directory."

done

for file in $DOT_HOME/config/*; do
    filename=$(echo $file | rev | cut -d'/' -f-1 | rev)
    target=$HOME/.config/$filename

    # check if the target file is already a symlink to the file
    if [ "$(readlink "$target")" = $file ]; then
        echo "$filename is already symlinked."
        continue
    fi

    # save target file if it already exists
    if [ -e $target ]; then
        echo "Moving existing $target to ~/dotfiles/.old/.config/"
        mkdir -p $DOT_HOME/.old/.config && mv $target $_
    fi

    ln -s "$file" "$HOME/.config"
    echo "Created symlink to $filename in .config directory."
done

echo "...done."
echo

# ============================================================================
# Install Packages
# ============================================================================

packages="curl vim exuberant-ctags"

echo "Installing packages..."
sudo apt-get update
sudo apt-get -y --ignore-missing install $packages
echo "...done."
echo

